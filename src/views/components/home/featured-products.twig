{#
  MALFUFA — featured-products.twig
  Displays a grid of products from the store.
  Salla passes `products` variable to homepage automatically.
#}
<section class="featured-products">
  <div class="section-header">
    <h2>{{ trans('home.bestsellers_title') }}</h2>
    <p>{{ trans('home.bestsellers_sub') }}</p>
  </div>

  {% if products is not empty %}
    <div class="products-grid">
      {% for product in products %}
        <div class="product-card">
          <a href="{{ product.url }}" class="product-card-link">

            <div class="product-image-wrap">
              {% if product.thumbnail.url and not (product.thumbnail.url | is_placeholder) %}
                <img
                  src="{{ product.thumbnail.url }}"
                  alt="{{ product.name }}"
                  loading="lazy"
                  width="400" height="400">
              {% else %}
                <div class="product-no-image">
                  <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                    <rect x="3" y="3" width="18" height="18" rx="2"/>
                    <circle cx="8.5" cy="8.5" r="1.5"/>
                    <polyline points="21,15 16,10 5,21"/>
                  </svg>
                </div>
              {% endif %}

              {% if product.is_on_sale %}
                <span class="badge-sale">{{ trans('product.sale') }}</span>
              {% endif %}

              {% if product.is_new %}
                <span class="badge-new">{{ trans('product.new') }}</span>
              {% endif %}
            </div>

            <div class="product-info">
              <h3 class="product-title">{{ product.name }}</h3>
              <div class="product-price">
                <span class="price">{{ product.price.amount | currency }}</span>
                {% if product.is_on_sale and product.price.original_amount %}
                  <span class="compare-price">{{ product.price.original_amount | currency }}</span>
                {% endif %}
              </div>
            </div>

          </a>

          {# Add to Cart — uses Salla's built-in cart event system #}
          <button class="add-to-cart-btn"
            data-product-id="{{ product.id }}"
            onclick="sallaAddToCart('{{ product.id }}', this)">
            <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/>
              <line x1="3" y1="6" x2="21" y2="6"/>
              <path d="M16 10a4 4 0 0 1-8 0"/>
            </svg>
            {{ trans('product.add_to_cart') }}
          </button>

        </div>
      {% endfor %}
    </div>
  {% else %}
    <p class="no-products">{{ trans('home.no_products') }}</p>
  {% endif %}

  <div class="section-cta">
    <a href="{{ link('products') }}" class="btn-outline">
      {{ trans('product.view_all') }}
    </a>
  </div>
</section>
